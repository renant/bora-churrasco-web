"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),r=require("@sanity/icons"),s=require("@sanity/ui"),i=require("sanity/router"),o=require("rxjs");const a=r.ComposeIcon,c="presentation",u="Presentation",d=t.createContext(null),l={locations:[]};const m={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},p={positive:r.InfoOutlineIcon,caution:r.WarningOutlineIcon,critical:r.ErrorOutlineIcon};function x(i){const{documentId:a,options:x,schemaType:f,showPresentationTitle:g}=i,j=t.useContext(d),{message:y,locations:I,tone:T}=function(e){const{id:r,locate:s,type:i}=e,a=n.useDocumentStore(),[c,u]=t.useState(l);return t.useEffect((()=>{if(!s)return;const e=s({id:r,type:i},{documentStore:a}),t=(o.isObservable(e)?e:o.of(e)).subscribe((e=>u(e||l)));return()=>t.unsubscribe()}),[a,r,s,i]),c}({id:a,locate:x.locate,type:f.name}),v=I?.length||0,[b,C]=t.useState(!1),S=t.useCallback((()=>C((e=>!e))),[]),P=y||(v?e.jsxs(e.Fragment,{children:["Used on ",m[v]||v," ",1===v?e.jsx(e.Fragment,{children:"page"}):e.jsx(e.Fragment,{children:"pages"})]}):null);return 0!==v||P?e.jsx(s.Card,{padding:1,radius:3,border:!0,tone:T,children:e.jsxs("div",{style:{margin:-1},children:[!I&&e.jsxs(s.Flex,{align:"flex-start",gap:3,padding:3,children:[T&&e.jsx(s.Box,{flex:"none",children:e.jsx(s.Text,{size:1,children:t.createElement(p[T])})}),e.jsx(s.Box,{flex:1,children:e.jsxs(s.Text,{size:1,weight:"medium",children:[g&&e.jsxs(e.Fragment,{children:[x.title||u," · "]}),P]})})]}),I&&e.jsxs(e.Fragment,{children:[e.jsx(s.Card,{as:"button",onClick:S,padding:3,radius:2,tone:"inherit",children:e.jsxs(s.Flex,{gap:3,children:[e.jsx(s.Box,{flex:"none",children:e.jsx(s.Text,{size:1,children:e.jsx(r.ChevronRightIcon,{style:{transform:`rotate(${b?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e.jsx(s.Box,{flex:1,children:e.jsxs(s.Text,{size:1,weight:"medium",children:[g&&e.jsxs(e.Fragment,{children:[x.title||u," · "]}),P]})})]})}),e.jsx(s.Stack,{hidden:!b,marginTop:1,space:1,children:I.map(((t,n)=>e.jsx(h,{active:(x.name||c)===j?.name&&t.href===j?.params.preview,documentId:a,documentType:f.name,node:t,toolName:x.name||c},n)))})]})]})}):null}function h(n){const{documentId:o,documentType:a,node:c,active:u,toolName:l}=n,m=t.useContext(d),p=m?.setParams,x=i.useIntentLink({intent:"edit",params:{id:o,type:a,mode:"presentation",presentation:l,...m?.deskParams,preview:c.href}}),h=t.useCallback((()=>{p?.({...m?.params,preview:c.href})}),[c.href,m?.params,p]);return t.createElement(s.Card,{...m?{}:x,as:m?"button":"a",key:c.href,onClick:h,padding:3,radius:2,pressed:u,tone:"inherit"},e.jsxs(s.Flex,{gap:3,children:[e.jsx(s.Box,{flex:"none",children:e.jsx(s.Text,{size:1,children:e.jsx(r.DesktopIcon,{})})}),e.jsxs(s.Stack,{flex:1,space:2,children:[e.jsx(s.Text,{size:1,weight:"medium",children:c.title}),e.jsx(s.Text,{muted:!0,size:1,textOverflow:"ellipsis",children:c.href})]})]}))}function f(r){const{documentId:i,schemaType:o}=r,a=n.useEditState(i,o.name),c=n.useConnectionState(i,o.name),u=a.draft||a.published,d=u?._id||i,{error:l,value:m,isLoading:p}=n.unstable_useValuePreview({enabled:"connected"===c,schemaType:o,value:t.useMemo((()=>({_type:"reference",_ref:d})),[d])}),x=o.title||o.name,h=m?.title;return l||p?null:e.jsxs(s.Stack,{space:3,children:[x!==h&&e.jsx(s.Text,{muted:!0,size:1,children:x}),e.jsx(s.Heading,{as:"h1",muted:!m?.title,size:3,children:m?.title||e.jsx("em",{children:"Untitled"})})]})}const g=t.createContext(null);function j(r){const{documentId:i,options:o,schemaType:a}=r,c=t.useContext(g),u=t.useMemo((()=>{const[e,t]=n.SANITY_VERSION.split(".").map(Number);return e<=3&&t<=22}),[]);if(c&&c.options[0]!==o)return null;const d=c?.options?.length||0;return e.jsxs(s.Stack,{marginBottom:5,space:5,children:[u&&e.jsx(f,{documentId:i,options:o,schemaType:a}),e.jsx(s.Stack,{space:2,children:c?.options.map(((t,n)=>e.jsx(x,{documentId:i,options:t,schemaType:a,showPresentationTitle:d>1},n)))})]})}function y(n){const{children:r,options:s}=n,i=t.useContext(g),o=i?.register,[a,c]=t.useState((()=>[])),u=t.useCallback((e=>o?o(e):(c((t=>[e].concat(t))),()=>{c((t=>t.filter((t=>t!==e))))})),[o]),d=t.useRef(u);d.current=u;const l=t.useMemo((()=>({options:i?.options||a,register:u})),[a,i,u]);return t.useEffect((()=>d.current(s)),[s]),e.jsx(g.Provider,{value:l,children:r})}const I=n.defineDocumentFieldAction({name:"presentation/openInStructure",useAction({documentId:e,documentType:s,path:o}){const a=n.useWorkspace(),{navigateIntent:c}=i.useRouter(),u=t.useContext(d),l=t.useMemo((()=>function(e,t,r){const s=e.map((e=>{const n=e.canHandleIntent?.("edit",{id:t,type:r,mode:"structure"},{});return{tool:e,match:n}})),i=s.filter((e=>n.isRecord(e.match)&&e.match.mode));if(i.length>0)return i[0].tool;const o=s.filter((e=>e.match));return o[0]?.tool}(a.tools,e,s)),[e,s,a.tools]);return{type:"action",hidden:!u||o.length>0||!l,icon:l?.icon||r.MasterDetailIcon,title:`Open in ${l?.title||"Structure"}`,onAction(){c("edit",{id:e,type:s,mode:"structure",path:n.pathToString(o)})},renderAsButton:!0}}});function T(e,t,r,s){const{id:i,mode:o,path:a,presentation:c,type:u,...d}=t;return"edit"===e&&i?{type:u||"*",id:n.getPublishedId(i),path:a,_searchParams:Object.entries(d)}:{intent:e,params:t,payload:s}}const v=i.route.create("/",{__unsafe_disableScopedSearchParams:!0},[i.route.intents("/intent"),i.route.create("/:type",[i.route.create("/:id"),i.route.create("/:id/:path")])]),b=t.lazy((()=>Promise.resolve().then((function(){return require("./PresentationTool-HDaNb3vI.cjs")})))),C=n.definePlugin((t=>{const r=t.name||c;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==I.name)),I]},form:{components:{input:function(r){const s=r.value,i=s?._id?n.getPublishedId(s?._id):void 0;return n.isDocumentSchemaType(r.schemaType)?e.jsxs(y,{options:t,children:[i&&e.jsx(j,{documentId:i,options:t,schemaType:r.schemaType}),r.renderDefault(r)]}):r.renderDefault(r)}}},tools:[{icon:t.icon||a,name:r,title:t.title,component:b,options:t,canHandleIntent(e,t){if("edit"===e){if(!t.id)return!1;if(t.presentation&&t.presentation!==r)return!1;if(!t.mode)return!0;if("presentation"===t.mode)return{mode:!0}}return!1},getIntentState:T,router:v}]}})),S=t.createContext(null);const P=t.createContext(null);exports.A="2023-10-16",exports.D=c,exports.M=3e3,exports.P=d,exports.a=S,exports.b=P,exports.c=function(){const e=t.useContext(P);if(!e)throw new Error("Presentation params context is missing");return e},exports.p=C,exports.u=function(){const e=t.useContext(S);if(!e)throw new Error("Presentation navigate context is missing");return e};//# sourceMappingURL=index-I0zX6oTy.cjs.map
