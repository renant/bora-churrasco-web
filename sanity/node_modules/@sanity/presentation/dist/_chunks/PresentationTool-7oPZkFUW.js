import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{applySourceDocuments as r,studioPath as i}from"@sanity/client/csm";import{Card as o,Flex as a,Container as s,Stack as c,Text as d,Inline as l,Box as u,Button as p,Code as h,Label as f,ErrorBoundary as m,TextInput as v,Switch as g,usePrefersReducedMotion as w,TooltipDelayGroupProvider as y,Tooltip as b,MenuButton as S,Menu as x,MenuItem as k,Spinner as P}from"@sanity/ui";import{useContext as I,forwardRef as z,useCallback as E,useMemo as D,useState as C,useEffect as $,useSyncExternalStore as j,createContext as M,memo as L,useLayoutEffect as _,useRef as O,createElement as U,startTransition as R}from"react";import{useUnique as T,getPublishedId as N,useEditState as W,useClient as A,useActiveWorkspace as K,useCurrentUser as F,useProjectId as J,useDataset as q}from"sanity";import{StateLink as V,useRouter as B}from"sanity/router";import G from"styled-components";import{P as Q,a as H,b as X,M as Z,A as Y,D as ee}from"./index-gmES5bvQ.js";import{PaneRouterContext as te,PaneLayout as ne,DeskToolProvider as re,DocumentListPane as ie,useDeskTool as oe,DocumentPane as ae}from"sanity/desk";import{unstable__getDocumentCacheKey as se,unstable__documentsCache as ce}from"@sanity/groq-store";import{applyPatch as de}from"mendoza";import{ResetIcon as le,LaunchIcon as ue,PanelLeftIcon as pe,RefreshIcon as he,ChevronDownIcon as fe,CheckmarkIcon as me,DesktopIcon as ve,MobileDeviceIcon as ge,EditIcon as we,PublishIcon as ye,DatabaseIcon as be}from"@sanity/icons";import{withoutSecretSearchParams as Se}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as xe,MotionConfig as ke,AnimatePresence as Pe}from"framer-motion";import Ie from"lodash.isequal";import{createPreviewSecret as ze}from"@sanity/preview-url-secret/create-secret";import{definePreviewUrl as Ee}from"@sanity/preview-url-secret/define-preview-url";import{suspend as De}from"suspend-react";let Ce;const $e=new Uint8Array(16);function je(){if(!Ce&&(Ce="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ce($e)}const Me=[];for(let e=0;e<256;++e)Me.push((e+256).toString(16).slice(1));var Le={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function _e(e,t,n){if(Le.randomUUID&&!t&&!e)return Le.randomUUID();const r=(e=e||{}).random||(e.rng||je)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Me[e[t+0]]+Me[e[t+1]]+Me[e[t+2]]+Me[e[t+3]]+"-"+Me[e[t+4]]+Me[e[t+5]]+"-"+Me[e[t+6]]+Me[e[t+7]]+"-"+Me[e[t+8]]+Me[e[t+9]]+"-"+Me[e[t+10]]+Me[e[t+11]]+Me[e[t+12]]+Me[e[t+13]]+Me[e[t+14]]+Me[e[t+15]]}(r)}const Oe=1e3,Ue=1e3,Re=500,Te=["handshake/syn","handshake/syn-ack","handshake/ack"],Ne=e=>Te.some((t=>t===e)),We=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function Ae(e){const t=e.frame.contentWindow,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(Ne(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),d(e,"handshake/ack",{id:e.id}))}}const o=t=>{const{data:r}=t;if(!Ne(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),l(t,"channel/response",{responseTo:r.id},!1)}}};function a(t){if(We(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.frameOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=_e(),e.interval=window.setInterval((()=>{d(e,"handshake/syn",{id:e.id})}),Re)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:Ue;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{l(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function d(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:_e(),to:n.config.id,type:r};try{t?.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function l(n,r,i,o=!0){const a=_e();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${s.type}' on client '${e.id}' (ID: '${s.id}').`))}),Oe),o=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{t?.postMessage(s,{targetOrigin:e.frameOrigin})}catch(t){throw new Error(`Failed to postMessage '${s.id}' on client '${e.id}'`)}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,t,r)}))}}}function Ke(e){return null!==e&&Array.isArray(e)}const Fe=/^([A-Za-z]+):([0-9]+)$/,Je=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,qe=/^([A-Za-z]+):([a-z0-9]+)$/;const Ve={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Be(e,t){return e.every((e=>Ve[e]?t[Ve[e]]:t.key===e.toUpperCase()))}function Ge(e){return"Alt"===e.key}function Qe(n){const{children:r,message:i,onRetry:h,onContinueAnyway:f,...m}=n,v=e(p,{fontSize:1,mode:"ghost",onClick:h,text:"Retry"}),g=e(p,{fontSize:1,mode:"ghost",tone:"critical",onClick:f,text:"Continue anyway"});return e(o,{height:"fill",...m,children:e(a,{align:"center",height:"fill",justify:"center",children:e(s,{padding:4,sizing:"border",width:0,children:t(c,{space:4,children:[t(c,{space:3,children:[e(d,{size:1,weight:"semibold",children:"An error occured"}),e(d,{muted:!0,size:1,children:i})]}),r,h&&f?t(l,{space:2,children:[v,g]}):h?e(u,{children:v}):f?e(u,{children:g}):null]})})})})}function He(){const e=I(Q);if(!e)throw new Error("Presentation context is missing");return e}function Xe(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const Ze=z((function(t,n){const{deskParams:r,params:i}=He();return e(V,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),Ye=z((function(t,n){const{documentId:r,documentType:i,...o}=t;return e(V,{...o,ref:n,state:{id:r,type:i},title:void 0})}));function et(t){const{children:r,params:i,onDeskParams:o,previewUrl:a,refs:s}=t,{state:c,resolvePathFromState:d}=B(),l=T(Object.fromEntries(c._searchParams||[])),u=E((e=>`${d(c)}${Xe({...l,...e})}`),[d,l,c]),p=D((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,i=s?.find((e=>N(e._id)===n));return i?e(V,{...r,state:{id:i._id,type:i._type,_searchParams:Object.entries({preview:a})}}):e("div",{...r})},BackLink:Ze,ReferenceChildLink:Ye,ParameterizedLink:()=>e(n,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{o({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:u})),[u,o,i,a,s]);return e(te.Provider,{value:p,children:r})}const tt=G(ne)`
  height: 100%;
`,nt=G(a)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,rt=G(h)`
  white-space: pre-wrap;
`;function it(n){const{onDeskParams:r,previewUrl:i,refs:a}=n,{devMode:s}=He(),d=D((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:a.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[a]),[l,u]=C(null),p=E((()=>u(null)),[]),h=D((()=>({})),[]);return $((()=>u(null)),[a]),l?e(Qe,{flex:1,message:"Could not render the document list",onRetry:p,children:s&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Error message"}),e(rt,{size:1,children:l.error.message})]})})}):e(m,{onCatch:u,children:e(tt,{children:e(re,{children:e(et,{params:h,onDeskParams:r,previewUrl:i,refs:a,children:e(nt,{direction:"column",flex:1,children:e(ie,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}function ot(t){const{onDeskParams:n,previewUrl:r,refs:i}=t;return e(it,{onDeskParams:n,previewUrl:r,refs:i})}const at=G(h)`
  white-space: pre-wrap;
`;function st(n){const{documentId:r,documentType:i,params:a,onDeskParams:s,onFocusPath:d}=n,{devMode:l}=He(),u=D((()=>({id:r,options:{id:r,type:i},title:"",type:"document"})),[r,i]),[p,h]=C(null),v=E((()=>h(null)),[]);$((()=>{h(null)}),[r,i,a]);const{setLayoutCollapsed:g}=oe(),w=E((()=>g(!0)),[g]),y=E((()=>g(!1)),[g]);return p?e(Qe,{flex:1,message:"Could not render the document editor",onRetry:v,children:l&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Error message"}),e(at,{size:1,children:p.error.message})]})})}):e(m,{onCatch:h,children:e(ne,{style:{height:"100%"},onExpand:y,onCollapse:w,children:e(et,{onDeskParams:s,params:a,children:e(ae,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:d})})})})}function ct(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s}=t,c=W(r,i),d=c.draft||c.published;$((()=>s(d)),[d,s]);const l=E((e=>{d?._id&&a(d._id,e)}),[d,a]);return e(re,{children:e(st,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:l})})}function dt(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s,previewUrl:c,refs:d}=t;return r&&i?e(ct,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s}):e(ot,{onDeskParams:o,previewUrl:c,refs:d})}function lt(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}const ut=M(null);M(null);const pt=M(!1);let ht=!1;function ft(e,t,n,i,o,a){if("raw"===o)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return r(i,a,(r=>{if(r._projectId)return void(ht||(console.warn("Cross dataset references are not supported yet, ignoring source document",r),ht=!0));if(e?._id===r._id&&e?._type===r._type)return e;const i=se({projectId:t,dataset:n,perspective:o},r);return ce.get(i)}))}function mt(e,t,n){return`${e}-${t}-${JSON.stringify(n)}`}const vt=L((function(n){const{liveDocument:r,children:i,client:o,refreshInterval:a=2e3,perspective:s}=n;if("raw"===s)throw new Error("LiveStoreProvider does not support the raw perspective");const[c,d]=C([]),[l]=C((()=>new Map)),u=function(e){const[t]=C((()=>new Map)),n=E(((n,r,i,o,a)=>{t.has(n)||(t.set(n,{perspective:r,query:i,params:o,listeners:new Set}),e((e=>e.includes(n)?e:[...e,n])));const s=t.get(n);if(!s||!s.listeners)throw new TypeError("Inconsistent cache for key: "+n);const{listeners:c}=s;return c.add(a),()=>{c.delete(a),0===c.size&&(t.delete(n),e((e=>e.includes(n)?e.filter((e=>e!==n)):e)))}}),[t,e]);return D((()=>({cache:t,subscribe:n})),[t,n])}(d),[p]=C((()=>function(e,t,n){const r=mt(s,t,n);return{subscribe:e=>{const i=u.subscribe(r,s,t,n,e);return()=>i()},getSnapshot:()=>l.get(r)}})),[h,f]=C([]),m=E((e=>{const t=new Set;if(e.documents?.length)for(const{_id:n}of e.documents)t.add(n);f((e=>{const n=Array.from(new Set([...e,...t]));return JSON.stringify(n.sort())===JSON.stringify(e.sort())?e:n}))}),[]);return t(ut.Provider,{value:p,children:[e(pt.Provider,{value:!0,children:i}),e(yt,{liveDocument:r,cache:u.cache,client:o,setTurboIds:f,snapshots:l,turboIds:h,perspective:s}),c.map((t=>{if(!u.cache.has(t))return null;const{query:n,params:i,listeners:c}=u.cache.get(t);return e(wt,{liveDocument:r,client:o,listeners:c,params:i,query:n,refreshInterval:a,snapshots:l,turboIdsFromSourceMap:m,perspective:s},t)}))]})}));vt.displayName="LiveStoreProvider";var gt=vt;const wt=L((function(e){const{liveDocument:t,client:n,refreshInterval:r,query:i,params:o,listeners:a,snapshots:s,turboIdsFromSourceMap:c,perspective:d}=e,{projectId:l,dataset:u}=D((()=>{const{projectId:e,dataset:t}=n.config();return{projectId:e,dataset:t}}),[n]),[p,h]=C(null);if(p)throw p;const[f,m]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=C(!1);$((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=j(lt,(()=>document.visibilityState),(()=>"hidden"));return!e||"hidden"===n}(),[r,i]=C("hit"),o=E((()=>(i("inflight"),()=>i("hit"))),[]);return $((()=>{if(!t||"hit"!==r)return;const e=setTimeout((()=>i("stale")),t);return()=>clearTimeout(e)}),[t,r]),$((()=>{if("hit"!==r)return;const e=()=>i("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,r]),$((()=>{n&&"hit"===r&&i("stale"),n||"stale"!==r||i("refresh")}),[n,r]),[r,o]}({refreshInterval:r}),v="refresh"===f||"inflight"===f;return $((()=>{if(!v)return;let e=!1;const r=new AbortController;const p=m();return async function(){const{signal:p}=r,{result:h,resultSourceMap:f}=await n.fetch(i,o,{tag:"presentation-loader",signal:p,perspective:d,filterResponse:!1});if(!p.aborted){s.set(mt(d,i,o),{result:f?ft(t,l,u,h,d,f):h,resultSourceMap:f}),f&&c(f);for(const e of a.values())e();e=!0}}().catch((e=>{"AbortError"!==e.name&&h(e)})).finally(p),()=>{e||r.abort()}}),[t,n,u,a,o,l,i,v,s,m,c,d]),null}));wt.displayName="QuerySubscription";const yt=L((function(t){const{liveDocument:r,client:i,snapshots:o,cache:a,turboIds:s,setTurboIds:c,perspective:d}=t,{projectId:l,dataset:u}=D((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]);$((()=>{const e=new Set;for(const{perspective:t,query:n,params:r}of a.values()){const i=mt(t,n,r),a=o.get(i);if(a&&a.resultSourceMap?.documents?.length)for(const{_id:t}of a.resultSourceMap.documents)e.add(t)}const t=[...e].sort();JSON.stringify(s)!==JSON.stringify(t)&&c(t)}),[a,c,o,s]);const[p,h]=C([]);$((()=>{const e=new Set(p.flat()),t=new Set;for(const n of s)e.has(n)||ce.has(se({projectId:l,dataset:u,perspective:d},{_id:n}))||t.add(n);const n=[...t].slice(0,10);0!==n.length&&h((e=>[...e.slice(-10),n]))}),[p,u,d,l,s]);const[f,m]=C();$((()=>{const e=i.listen("published"===d?'*[!(_id in path("drafts.**"))]':'*[_id in path("drafts.**")]',{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"!==e.type||!e.effects?.apply?.length)return;const t=se({projectId:l,dataset:u,perspective:d},{_id:e.documentId}),n=ce.peek(t);if(n){const r={...n};delete r._rev;const i=de(r,e.effects.apply);ce.set(t,i)}m(e.documentId)}));return()=>e.unsubscribe()}),[i,u,d,l]),$((()=>{if(!f||!s.includes(f))return;const e=[];for(const[t,n]of o.entries())n.resultSourceMap?.documents?.length&&(n.result=ft(r,l,u,n.result,d,n.resultSourceMap),e.push(t));for(const t of e){const e=a.get(t)?.listeners;if(e)for(const t of e)t()}m(void 0)}),[r,a,u,f,d,l,o,s]);const[v,g]=C();return $((()=>{if(!v)return;const e=[];for(const[t,n]of o.entries())n.resultSourceMap?.documents?.length&&(n.result=ft(r,l,u,n.result,d,n.resultSourceMap),e.push(t));for(const t of e){const e=a.get(t)?.listeners;if(e)for(const t of e)t()}}),[a,u,r,v,d,l,o]),$((()=>{r&&g(r._rev)}),[r]),e(n,{children:p.map((t=>e(bt,{client:i,projectId:l,dataset:u,ids:t,perspective:d},JSON.stringify(t))))})}));yt.displayName="Turbo";const bt=L((function(e){const{client:t,projectId:n,dataset:r,ids:i,perspective:o}=e;return $((()=>{const e=i.filter((e=>!ce.has(se({projectId:n,dataset:r,perspective:o},{_id:e}))));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&ce.set(se({projectId:n,dataset:r,perspective:o},t),t)}),console.error)}),[t,r,i,o,n]),null}));function St(e,t,n){const r=I(ut);if(!r)throw new Error("useLiveQuery must be used inside a <LiveQueryProvider />");const i=function(e){const t=D((()=>JSON.stringify(e||{})),[e]);return D((()=>JSON.parse(t)),[t])}(n),o=D((()=>r(e,t,i)),[r,e,i,t]),[a]=C((()=>{if(void 0===e)throw new Error("initialSnapshot can't be undefined, if you don't want an initial value use null instead");try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable",{initialSnapshot:e,error:t}),e}})),s=E((()=>a),[a]);return j(o.subscribe,o.getSnapshot,s)}function xt(t){const{activePerspective:n,liveDocument:r,channel:i,perspective:o,liveQueries:a}=t,s=A({apiVersion:"2023-10-16"}),c=D((()=>s.config()),[s]),d=D((()=>s.withConfig({perspective:o,resultSourceMap:"withKeyArraySelector"})),[o,s]);return $((()=>{if(i&&n){const{projectId:e,dataset:t}=c;i.send("loaders","loader/perspective",{projectId:e,dataset:t,perspective:o})}}),[n,i,c,o]),e(gt,{liveDocument:r,client:d,perspective:o,refreshInterval:n?2e3:0,children:Object.entries(a).map((([t,{query:n,params:r}])=>e(kt,{projectId:c.projectId,dataset:c.dataset,perspective:o,query:n,params:r,channel:i},`${t}${o}`)))})}function kt(e){const{projectId:t,dataset:n,perspective:r,query:i,params:o,channel:a}=e,s=St(null,i,o),c=s?.result,d=s?.resultSourceMap;return $((()=>{d&&a.send("loaders","loader/query-change",{projectId:t,dataset:n,perspective:r,query:i,params:o,result:c,resultSourceMap:d})}),[a,n,o,r,t,i,c,d]),null}bt.displayName="GetDocuments";const Pt=M(null);Pt.displayName="PanelsContext";const It=G.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,zt=function({children:t,defaultSize:n=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const s=I(Pt);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:d,unregisterElement:l}=s,u=c(r);return _((()=>(d(r,{id:r,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:i??0,order:a}),()=>{l(r)})),[r,n,a,o,i,d,l]),e(It,{style:u,children:t})};const Et=G.div`
  position: relative;
`,Dt=G.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-shadow-outline-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Ct=function({id:n,order:r,disabled:i=!1}){const o=O(null),a=I(Pt);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return O(e||_e()).current}(n),{activeResizer:c,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:h}=a,f=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=E((e=>{l(s,e.nativeEvent)}),[s,l]),v=E((e=>{d(s,e)}),[s,d]),g=E((()=>{o.current.blur(),u()}),[u]);return $((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),_((()=>(p(s,{id:s,order:r,type:"resizer",el:o}),()=>{h(s)})),[s,r,p,h]),e(Et,{onMouseDown:m,ref:o,children:t(Dt,{$disabled:i,children:[e("span",{}),e("span",{})]})})};function $t(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const jt="presentation/panels",Mt=()=>JSON.parse(localStorage.getItem(jt)||"{}"),Lt=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function _t(){return D((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(jt,JSON.stringify(e))})({...Mt(),[Lt(e)]:t})};return{get:e=>Mt()[Lt(e)],set:e,setDebounced:$t(e,100)}}),[])}function Ot(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function Ut(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Rt(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Tt(e){return"panel"===e.type}function Nt(e){return"resizer"===e.type}function Wt(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function At(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=Ot(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const Kt=G.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Ft=function({children:t}){const n=O(null),[r,i]=C(new Map),o=D((()=>Wt(r).filter(Tt)),[r]),[a,s]=C([]),[c,d]=C(null),l=O({elements:r,panels:o,widths:a}),u=E((e=>({flexGrow:Ut(o,e,a),pointerEvents:null===c?void 0:"none"})),[c,o,a]),p=E(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=E((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),f=O({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),m=E(((e,t)=>{const n=Wt(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!Nt(o))return;const a=o.el.current;a&&(f.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>Tt(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Tt(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Rt(t,a),resizerRect:a.getBoundingClientRect(),widths:l.current.widths},d(e))}),[r]),v=E((()=>{d(null)}),[]),g=E(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:c,resizerRect:d}=f.current;if(null==a||null==c)return;const u=r.get(e);if(!u||!Nt(u))return;const p=u.el.current;if(!p)return;const h=Rt(t,p,o,d);if(0===h)return;const{widths:m}=l.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,d=c||s,l=[...d];{const i=e<0?r:n,o=d[a.findIndex((e=>e.id===i.id))],s=Ot(i,o+Math.abs(e),t);if(o===s)return d;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,h=a.findIndex((e=>e.id===p.id));for(;;){const n=a[h],r=d[h],i=Ot(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,l[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===u?d:(p=e<0?r:n,h=a.findIndex((e=>e.id===p.id)),l[h]=d[h]+u,l)}(h/n.current.getBoundingClientRect().width*100,i,a,c,l.current,f.current),g=m.some(((e,t)=>e!==v[t]));g&&s(v)}),[r]);_((()=>{l.current.elements=r,l.current.panels=o,l.current.widths=a}),[r,o,a]);const w=_t();_((()=>{const{widths:e}=l.current;if(e.length===o.length)return;const t=w.get(o);if(t){const e=At(o,t,window.innerWidth);return void s(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);s(n)}),[w,o]),$((()=>{a.length&&w.setDebounced(o,a)}),[w,o,a]),_((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=l.current,n=At(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&s(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=D((()=>({activeResizer:c,drag:g,getPanelStyle:u,registerElement:p,startDragging:m,stopDragging:v,unregisterElement:h})),[c,g,u,p,m,v,h]);return e(Pt.Provider,{value:y,children:e(Kt,{ref:n,children:t})})};function Jt(e){const{id:t,type:n}=e;return W(t,n),null}const qt=function(t){const{children:n,setParams:r}=t,i=E((e=>{r({preview:e})}),[r]),o=D((()=>i),[i]);return e(H.Provider,{value:o,children:n})},Vt=function(t){const{children:n,params:r}=t,i=D((()=>r),[r]);return e(X.Provider,{value:i,children:n})},Bt=function(t){const{children:n,deskParams:r,devMode:i,name:o,params:a,setParams:s}=t,c=D((()=>({deskParams:r,devMode:i,name:o,params:a,setParams:s})),[r,i,o,a,s]);return e(Q.Provider,{value:c,children:n})},Gt=xe(G.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),Qt=function(t){const{basePath:r="/"}=K()?.activeWorkspace||{},{fontSize:i=1,onChange:o,origin:a,padding:s=3,value:c}=t,d=O(null),[l,h]=C(void 0),[f,m]=C(void 0),g=E((e=>{h(e.currentTarget.value)}),[]),w=E((e=>{if("Enter"===e.key){if(void 0===l)return;const e=l.startsWith("/")||""===l?`${a}${l}`:l;if(!e.startsWith(a+"/")&&e!==a)return void m(`URL must start with ${a}`);if(!a&&(e.startsWith(`${r}/`)||e===r))return void m(`URL can't have the same base path as the Studio ${r}`);const t=e===a?a+"/":e;m(void 0),h(void 0),o(t.slice(a.length)),d.current?.blur()}"Escape"===e.key&&(m(void 0),h(void 0))}),[r,o,a,l]),y=E((()=>{m(void 0),h(void 0)}),[]);$((()=>{m(void 0),h(void 0)}),[a,c]);const b=D((()=>({icon:le})),[]);return e(n,{children:e(v,{clearButton:f?b:void 0,customValidity:f,fontSize:i,onBlur:y,onClear:()=>{m(void 0),h(a+c)},onChange:g,onKeyDownCapture:w,padding:s,style:{zIndex:1},radius:2,ref:d,space:s,suffix:e(u,{padding:1,style:{lineHeight:0,zIndex:-1},children:e(p,{as:"a",fontSize:i,href:a+(l||c),icon:ue,padding:s-1,mode:"bleed",rel:"noreferrer",target:"_blank"})}),value:void 0===l?`${a}${c}`:l})})},Ht=xe(a),Xt=G(g)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,Zt={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Yt="caution",en="positive",tn={previewDrafts:we,published:ye,raw:be},nn=z((function(r,i){const{initialUrl:s,targetOrigin:l,navigatorEnabled:m,onPathChange:v,overlayEnabled:g,params:I,perspective:z,setPerspective:j,toggleNavigator:M,toggleOverlay:L,loadersConnection:_,overlaysConnection:O,previewKitConnection:R}=r,{devMode:T}=He(),[N,W]=C("desktop"),A=w(),K=E((()=>W("desktop")),[W]),F=E((()=>W("mobile")),[W]),[J,q]=C(!0),[V,B]=C(!1),[G,Q]=C(!1),[H,X]=C(!1),Y=J||G||"connecting"===O,ee=D((()=>l===location.origin?"":l),[l]),te=E((()=>{"function"!=typeof i&&i?.current&&(i.current.src=`${l}${I.preview||"/"}`,Q(!0))}),[I.preview,l,i]),ne=E((()=>{"function"!=typeof i&&i?.current&&(i.current.src=s.toString(),Q(!0))}),[i,s]),re=E((()=>{oe(!0)}),[]),[ie,oe]=C(!1),[ae,se]=C(!1);$((()=>{if(!(J||G||"connecting"!==O&&"reconnecting"!==O)){const e=setTimeout((()=>{se(!0)}),1e3);return()=>clearTimeout(e)}}),[O,J,G,se]),$((()=>{if(!J&&!G&&ae){if("connected"===O&&(X(!1),se(!1),B(!1),oe(!1)),"connecting"===O){const e=setTimeout((()=>{B(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),Z);return()=>clearTimeout(e)}if("reconnecting"===O){const e=setTimeout((()=>{B(!0),X(!0)}),Z);return()=>clearTimeout(e)}"disconnected"===O&&X(!0)}}),[J,O,G,ae]);const ce=D((()=>{const e=new URL(I.preview||"/",l),{pathname:t,search:n}=Se(e);return`${t}${n}`}),[I.preview,l]),de=E((()=>{q(!1),Q(!1)}),[]);return e(ke,{transition:A?{duration:0}:void 0,children:t(y,{delay:1e3,children:[e(o,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:t(a,{align:"center",gap:2,style:{minHeight:0},children:[M&&e(b,{content:e(d,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Toggle navigator",fontSize:1,icon:pe,mode:"bleed",onClick:M,padding:3,selected:m})}),e(b,{content:e(a,{align:"center",style:{whiteSpace:"nowrap"},children:e(u,{padding:1,children:e(d,{size:1,children:g?"Disable edit overlay":"Enable edit overlay"})})}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(o,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:g?"positive":void 0,children:t(a,{align:"center",gap:2,children:[e("div",{style:{margin:-2},children:e(Xt,{checked:g,onChange:L,disabled:Y})}),e(u,{children:e(d,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),T&&e(b,{content:e(d,{size:1,children:G?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Refresh preview",fontSize:1,icon:he,mode:"bleed",loading:G,onClick:te,padding:3})}),e(u,{flex:1,children:e(Qt,{onChange:v,origin:ee,value:ce})}),e(a,{align:"center",flex:"none",gap:1,children:e(S,{button:e(p,{fontSize:1,iconRight:fe,mode:"bleed",padding:3,space:2,text:Zt[z],loading:Y||"connecting"===_&&"connected"!==R,disabled:"connected"!==_}),id:"perspective-menu",menu:t(x,{style:{maxWidth:240},children:[e(k,{fontSize:1,onClick:()=>j("previewDrafts"),padding:3,pressed:"previewDrafts"===z,tone:Yt,children:t(a,{align:"flex-start",gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:U(tn.previewDrafts)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:Zt.previewDrafts}),e(d,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e(u,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"previewDrafts"===z?1:0},children:e(me,{})})})]})}),e(k,{fontSize:1,onClick:()=>j("published"),padding:3,pressed:"published"===z,tone:en,children:t(a,{align:"flex-start",gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:U(tn.published)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:Zt.published}),e(d,{muted:!0,size:1,children:"View this page with published content"})]}),e(u,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"published"===z?1:0},children:e(me,{})})})]})})]}),popover:{constrainSize:!0,placement:"bottom",portal:!0}})}),t(a,{align:"center",flex:"none",gap:1,children:[e(b,{content:e(d,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Full viewport",fontSize:1,icon:ve,mode:"bleed",onClick:K,padding:3,selected:"desktop"===N})}),e(b,{content:e(d,{size:1,children:"Narrow viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Narrow viewport",fontSize:1,icon:ge,mode:"bleed",onClick:F,padding:3,selected:"mobile"===N})})]})]})}),e(o,{flex:1,tone:"transparent",children:t(a,{align:"center",height:"fill",justify:"center",padding:"desktop"===N?0:2,sizing:"border",style:{position:"relative",cursor:Y?"wait":void 0},children:[e(Pe,{children:H||J||G||!ae||ie?!J&&!Y||ie?H&&!ie?e(Ht,{initial:"initial",animate:"animate",exit:"exit",variants:an,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},children:e(Qe,{flex:1,message:"Could not connect to the preview",onRetry:ne,onContinueAnyway:re,children:T&&t(n,{children:["connected"!==O&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Overlay connection status"}),e(h,{size:1,children:O})]})}),"connected"!==_&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Loader connection status"}),e(h,{size:1,children:_})]})})]})})}):null:e(Ht,{initial:"initial",animate:"animate",exit:"exit",variants:on,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:t(a,{style:{...rn[N]},justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(d,{muted:!0,size:1,children:"Loading…"})]})}):e(Ht,{initial:"initial",animate:"animate",exit:"exit",variants:on,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:V?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",zIndex:1},children:t(a,{style:{...rn[N]},justify:"center",align:"center",direction:"column",gap:4,children:[V&&e(p,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e(o,{radius:2,tone:V?"caution":"inherit",padding:4,shadow:1,children:t(a,{justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(d,{muted:!0,size:1,children:V?e(n,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),V&&e(p,{fontSize:1,tone:"critical",onClick:re,text:"Continue anyway"})]})})}),e(Gt,{ref:i,style:{pointerEvents:Y&&!ie?"none":"auto",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:sn,animate:[!J&&!Y||ie?"active":"background",G?"reloading":"idle",N,ae&&!ie?"timedOut":""],onLoad:de})]})})]})})})),rn={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},on={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},an={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},sn={desktop:{...rn.desktop,boxShadow:"0 0 0 0px var(--card-shadow-outline-color)"},mobile:{...rn.mobile,boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function cn(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function dn(e){if(void 0!==e)return i.toString(function(e){const t=[];for(const n of e.split(".")){const e=Fe.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=Je.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=qe.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function ln(e){return{id:cn(e.id),path:dn(e.path),type:e.type}}function un(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function pn({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r}){const[o,a]=C((()=>{const{id:t,path:i,type:o}=ln(n);return{id:t,type:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}})),s=E((e=>{a((t=>{const n={...t,...e};return Ie(un(t),un(n))?t:n}))}),[]),c=D((()=>un({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]);$((()=>{const{id:t,path:i,type:o}=ln(n),a=setTimeout((()=>s({id:t,type:"*"===o?void 0:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment})),0);return()=>clearTimeout(a)}),[e,r,n,s]);const d=D((()=>$t(((e,n)=>{const r=un(e);t(r,n)}),50)),[t]),l=O(o.preview);return $((()=>{const e=l.current;l.current=o.preview;const t=o.type,n=o.id,r=o.path?function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?Ke(n)?(t&&(t+=":"),t+=`${n.join(",")}}`):n._key&&(t&&(t+=":"),t+=`${n._key}`):(t&&(t+=":"),t+=`${n}`):(t&&(t+="."),t+=n);return t}(i.fromString(o.path)):void 0,a=un({preview:o.preview,perspective:"published"===o.perspective?"published":void 0,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}),s=o.preview===e,c=setTimeout((()=>d({type:t,id:n,path:r,_searchParams:Object.entries(a)},{replace:s})),0);return()=>clearTimeout(c)}),[d,o]),{navigate:d,setParams:s,deskParams:c,params:o}}function hn(e,t,n){const r=A({apiVersion:Y}),i=K(),o=i?.activeWorkspace?.basePath||"/",a=function(e,t,n){const r=F();return D((()=>["@sanity/presentation",t,n,e,r?.id,fn]),[t,r?.id,e,n])}(t,o,i?.activeWorkspace?.name||"default"),s=function(e,t){const n=A({apiVersion:Y}),r=F(),[i,o]=C(""),a=e?De((async()=>await ze(n,"@sanity/presentation","undefined"==typeof window?"":location.href,r?.id)),[...t,i]):null;return $((()=>{if(!a)return;const e=setTimeout((()=>{R((()=>o(a.expiresAt.toString())))}),a.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[a]),a?.secret||null}("object"==typeof e||"function"==typeof e,a);return De((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${o}/`)&&r.pathname!==o?r:t}const t="object"==typeof e?Ee(e):e,i=await t({client:r,previewUrlSecret:s,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:o});return new URL(i,location.origin)}),[...a,s])}const fn=Symbol();function mn(r){const{minWidth:i,maxWidth:o,component:a}=r,s=null!=i&&null!=o&&i===o;return t(n,{children:[e(zt,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(Ct,{order:2,disabled:s})]})}const vn=G(a)`
  overflow-x: auto;
`;function gn(r){const{previewUrl:o,components:s}=r.tool.options??{},c=r.tool.name||ee,{unstable_navigator:d}=s||{},{navigate:l,state:u}=B(),p=T(Object.fromEntries(u._searchParams||[])),h=hn(o||"/",c,p.preview||null),[f]=C((()=>{const e=r.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),m=D((()=>h.origin),[h.origin]),v=O(null),[g,w]=C(),[y,b]=C({}),{setParams:S,params:x,deskParams:k}=pn({initialPreviewUrl:h,routerNavigate:l,routerState:u,routerSearchParams:p}),[P,I]=C((()=>"published"===x.perspective?x.perspective:"previewDrafts")),[z,j]=function(e){const[t,n]=C((()=>({published:new Map,previewDrafts:new Map,raw:new Map}))),r=E(((e,t)=>{n((n=>{let r=!1,i=n[e];const o=e=>`${e._projectId}-${e.dataset}-${e._type}-${e._id}`,a=new Set;for(const e of t){const t=o(e);a.add(t),i.has(t)||(i.set(t,e),r=!0)}for(const e of i.keys())a.has(e)||(i.delete(e),r=!0);return r?(i=new Map(i),{...n,[e]:new Map(i)}):n}))}),[]),i=D((()=>t[e]),[e,t]);return[D((()=>[...i.values()]),[i]),r]}(P),[M,L]=C(!0),_=!!d?.component,[U,R]=function(e,t){const[n,r]=C((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return $((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",_),W=J(),A=q(),K=O(),F=O(x.id),V=D((()=>{if(_)return()=>R((e=>!e))}),[_,R]),[G,Q]=C((()=>z.slice(0,3).map((e=>({...e,_id:N(e._id)})))));$((()=>{P!==x.perspective&&S({perspective:P})}),[x.perspective,P,S]),$((()=>{Q(z.slice(0,3).map((e=>({...e,_id:N(e._id)}))))}),[z]),$((()=>{x.id!==F.current&&(F.current=x.id,x.id&&Q((e=>e.find((e=>e._id===x.id))?e:e.slice(1).concat([{_id:x.id,_type:x.type}]))))}),[x]);const[H,X]=C("connecting"),[Z,Y]=C("connecting"),[te,ne]=C("connecting");$((()=>{const e=v.current;if(!e)return;const t=Ae({id:"presentation",frame:e,frameOrigin:m,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:X,onEvent(e,t){if("overlay/focus"===e&&"id"in t)S({id:t.id,path:t.path,type:t.type});else if("overlay/navigate"===e){if(K.current!==t.url){const e=void 0===K.current;K.current=t.url,S(e?{preview:t.url}:{id:void 0,type:void 0,preview:t.url})}}else"overlay/toggle"===e&&L(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:Y,onEvent(e,t){"loader/documents"===e?j(t.perspective,t.documents):"loader/query-listen"===e&&t.projectId===W&&t.dataset===A&&b((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params}};var n,r}))}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:ne,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===W&&t.dataset===A&&j(t.perspective,t.documents)}}]});return w(t),()=>{t.destroy(),w(void 0)}}),[A,W,j,S,m]);const re=E(((e,t)=>{S({path:i.toString(t)})}),[S]),ie=E((e=>{const t=new URL(e,h.origin),n=t.pathname+t.search;t.origin===h.origin&&n!==x.preview&&S({id:void 0,path:void 0,preview:n})}),[h,x,S]),oe=E((e=>{S({...e})}),[S]);$((()=>{x.id&&x.path?g?.send("overlays","presentation/focus",{id:x.id,path:x.path}):g?.send("overlays","presentation/blur",void 0)}),[g,x.id,x.path]),$((()=>{K.current&&x.preview&&K.current!==x.preview&&(K.current=x.preview,"connected"!==H&&v.current?v.current.src=`${m}${x.preview}`:g?.send("overlays","presentation/navigate",{url:x.preview,type:"push"}))}),[g,H,m,x.preview]);const ae=E((()=>g?.send("overlays","presentation/toggleOverlay",void 0)),[g]),[se,ce]=C(null),de=E((e=>ce(e)),[]);return $((()=>{const e=e=>{Ge(e)&&ae()},t=e=>{Ge(e)&&ae(),Be(["mod","\\"],e)&&ae()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ae]),t(n,{children:[t(Bt,{deskParams:k,devMode:f,name:c,params:x,setParams:S,children:[G.map((t=>e(Jt,{id:t._id,type:t._type},t._id))),e(qt,{setParams:S,children:e(Vt,{params:x,children:e(vn,{height:"fill",children:t(Ft,{children:[_&&U&&e(mn,{...d}),e(zt,{id:"preview",minWidth:325,defaultSize:U?50:75,order:3,children:e(a,{direction:"column",flex:1,height:"fill",children:e(nn,{initialUrl:h,navigatorEnabled:U,onPathChange:ie,overlayEnabled:M,params:x,perspective:P,ref:v,setPerspective:I,targetOrigin:m,toggleNavigator:V,toggleOverlay:ae,loadersConnection:Z,overlaysConnection:H,previewKitConnection:te})})}),e(Ct,{order:4}),e(zt,{id:"content",minWidth:325,order:5,children:e(dt,{refs:z,deskParams:k,documentId:x.id,documentType:x.type,onDeskParams:oe,onFocusPath:re,onDocumentChange:de,previewUrl:x.preview})})]})})})})]}),g&&t(n,{children:[e(xt,{activePerspective:"published"===P,channel:g,liveQueries:y,perspective:"published",liveDocument:se?._id?.startsWith("drafts.")?null:se},"published"),e(xt,{activePerspective:"previewDrafts"===P,channel:g,liveQueries:y,perspective:"previewDrafts",liveDocument:se},"previewDrafts")]})]})}export{gn as default};//# sourceMappingURL=PresentationTool-7oPZkFUW.js.map
