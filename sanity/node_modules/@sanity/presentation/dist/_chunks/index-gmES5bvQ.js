import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{createContext as i,useState as r,useEffect as o,useContext as s,useCallback as a,createElement as c,useMemo as d,useRef as l,lazy as m}from"react";import{useDocumentStore as u,useEditState as p,useConnectionState as h,unstable_useValuePreview as f,SANITY_VERSION as g,defineDocumentFieldAction as y,useWorkspace as v,pathToString as T,isRecord as b,getPublishedId as w,definePlugin as x,isDocumentSchemaType as I}from"sanity";import{ComposeIcon as P,ChevronRightIcon as _,DesktopIcon as z,InfoOutlineIcon as S,WarningOutlineIcon as A,ErrorOutlineIcon as j,MasterDetailIcon as k}from"@sanity/icons";import{Card as D,Flex as N,Box as O,Text as B,Stack as C,Heading as E}from"@sanity/ui";import{useIntentLink as H,useRouter as U,route as $}from"sanity/router";import{isObservable as L,of as M}from"rxjs";const q=P,F="presentation",G="Presentation",J=3e3,K="2023-10-16",Q=i(null),R={locations:[]};const V={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},W={positive:S,caution:A,critical:j};function X(i){const{documentId:d,options:l,schemaType:m,showPresentationTitle:p}=i,h=s(Q),{message:f,locations:g,tone:y}=function(e){const{id:t,locate:n,type:i}=e,s=u(),[a,c]=r(R);return o((()=>{if(!n)return;const e=n({id:t,type:i},{documentStore:s}),r=(L(e)?e:M(e)).subscribe((e=>c(e||R)));return()=>r.unsubscribe()}),[s,t,n,i]),a}({id:d,locate:l.locate,type:m.name}),v=g?.length||0,[T,b]=r(!1),w=a((()=>b((e=>!e))),[]),x=f||(v?t(n,{children:["Used on ",V[v]||v," ",e(n,1===v?{children:"page"}:{children:"pages"})]}):null);return 0!==v||x?e(D,{padding:1,radius:3,border:!0,tone:y,children:t("div",{style:{margin:-1},children:[!g&&t(N,{align:"flex-start",gap:3,padding:3,children:[y&&e(O,{flex:"none",children:e(B,{size:1,children:c(W[y])})}),e(O,{flex:1,children:t(B,{size:1,weight:"medium",children:[p&&t(n,{children:[l.title||G," · "]}),x]})})]}),g&&t(n,{children:[e(D,{as:"button",onClick:w,padding:3,radius:2,tone:"inherit",children:t(N,{gap:3,children:[e(O,{flex:"none",children:e(B,{size:1,children:e(_,{style:{transform:`rotate(${T?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e(O,{flex:1,children:t(B,{size:1,weight:"medium",children:[p&&t(n,{children:[l.title||G," · "]}),x]})})]})}),e(C,{hidden:!T,marginTop:1,space:1,children:g.map(((t,n)=>e(Y,{active:(l.name||F)===h?.name&&t.href===h?.params.preview,documentId:d,documentType:m.name,node:t,toolName:l.name||F},n)))})]})]})}):null}function Y(n){const{documentId:i,documentType:r,node:o,active:d,toolName:l}=n,m=s(Q),u=m?.setParams,p=H({intent:"edit",params:{id:i,type:r,mode:"presentation",presentation:l,...m?.deskParams,preview:o.href}}),h=a((()=>{u?.({...m?.params,preview:o.href})}),[o.href,m?.params,u]);return c(D,{...m?{}:p,as:m?"button":"a",key:o.href,onClick:h,padding:3,radius:2,pressed:d,tone:"inherit"},t(N,{gap:3,children:[e(O,{flex:"none",children:e(B,{size:1,children:e(z,{})})}),t(C,{flex:1,space:2,children:[e(B,{size:1,weight:"medium",children:o.title}),e(B,{muted:!0,size:1,textOverflow:"ellipsis",children:o.href})]})]}))}function Z(n){const{documentId:i,schemaType:r}=n,o=p(i,r.name),s=h(i,r.name),a=o.draft||o.published,c=a?._id||i,{error:l,value:m,isLoading:u}=f({enabled:"connected"===s,schemaType:r,value:d((()=>({_type:"reference",_ref:c})),[c])}),g=r.title||r.name,y=m?.title;return l||u?null:t(C,{space:3,children:[g!==y&&e(B,{muted:!0,size:1,children:g}),e(E,{as:"h1",muted:!m?.title,size:3,children:m?.title||e("em",{children:"Untitled"})})]})}const ee=i(null);function te(n){const{documentId:i,options:r,schemaType:o}=n,a=s(ee),c=d((()=>{const[e,t]=g.split(".").map(Number);return e<=3&&t<=22}),[]);if(a&&a.options[0]!==r)return null;const l=a?.options?.length||0;return t(C,{marginBottom:5,space:5,children:[c&&e(Z,{documentId:i,options:r,schemaType:o}),e(C,{space:2,children:a?.options.map(((t,n)=>e(X,{documentId:i,options:t,schemaType:o,showPresentationTitle:l>1},n)))})]})}function ne(t){const{children:n,options:i}=t,c=s(ee),m=c?.register,[u,p]=r((()=>[])),h=a((e=>m?m(e):(p((t=>[e].concat(t))),()=>{p((t=>t.filter((t=>t!==e))))})),[m]),f=l(h);f.current=h;const g=d((()=>({options:c?.options||u,register:h})),[u,c,h]);return o((()=>f.current(i)),[i]),e(ee.Provider,{value:g,children:n})}const ie=y({name:"presentation/openInStructure",useAction({documentId:e,documentType:t,path:n}){const i=v(),{navigateIntent:r}=U(),o=s(Q),a=d((()=>function(e,t,n){const i=e.map((e=>{const i=e.canHandleIntent?.("edit",{id:t,type:n,mode:"structure"},{});return{tool:e,match:i}})),r=i.filter((e=>b(e.match)&&e.match.mode));if(r.length>0)return r[0].tool;const o=i.filter((e=>e.match));return o[0]?.tool}(i.tools,e,t)),[e,t,i.tools]);return{type:"action",hidden:!o||n.length>0||!a,icon:a?.icon||k,title:`Open in ${a?.title||"Structure"}`,onAction(){r("edit",{id:e,type:t,mode:"structure",path:T(n)})},renderAsButton:!0}}});function re(e,t,n,i){const{id:r,mode:o,path:s,presentation:a,type:c,...d}=t;return"edit"===e&&r?{type:c||"*",id:w(r),path:s,_searchParams:Object.entries(d)}:{intent:e,params:t,payload:i}}const oe=$.create("/",{__unsafe_disableScopedSearchParams:!0},[$.intents("/intent"),$.create("/:type",[$.create("/:id"),$.create("/:id/:path")])]),se=m((()=>import("./PresentationTool-7oPZkFUW.js"))),ae=x((n=>{const i=n.name||F;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==ie.name)),ie]},form:{components:{input:function(i){const r=i.value,o=r?._id?w(r?._id):void 0;return I(i.schemaType)?t(ne,{options:n,children:[o&&e(te,{documentId:o,options:n,schemaType:i.schemaType}),i.renderDefault(i)]}):i.renderDefault(i)}}},tools:[{icon:n.icon||q,name:i,title:n.title,component:se,options:n,canHandleIntent(e,t){if("edit"===e){if(!t.id)return!1;if(t.presentation&&t.presentation!==i)return!1;if(!t.mode)return!0;if("presentation"===t.mode)return{mode:!0}}return!1},getIntentState:re,router:oe}]}})),ce=i(null);function de(){const e=s(ce);if(!e)throw new Error("Presentation navigate context is missing");return e}const le=i(null);function me(){const e=s(le);if(!e)throw new Error("Presentation params context is missing");return e}export{K as A,F as D,J as M,Q as P,ce as a,le as b,me as c,ae as p,de as u};//# sourceMappingURL=index-gmES5bvQ.js.map
